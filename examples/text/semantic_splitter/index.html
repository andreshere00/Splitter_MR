
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../paged_splitter/">
      
      
        <link rel="next" href="../../schema/html_tag_splitter/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Split by semantic similarity - SplitterMR Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+3:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Source Sans 3";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../../../assets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#example-splitting-files-by-semantic-similarity-using-semanticsplitter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="SplitterMR Docs" class="md-header__button md-logo" aria-label="SplitterMR Docs" data-md-component="logo">
      
  <img src="../../../assets/splitter_mr_logo_reduced_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SplitterMR Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Split by semantic similarity
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/andreshere00/Splitter_MR" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    andreshere00/Splitter_MR
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="SplitterMR Docs" class="md-nav__button md-logo" aria-label="SplitterMR Docs" data-md-component="logo">
      
  <img src="../../../assets/splitter_mr_logo_reduced_white.svg" alt="logo">

    </a>
    SplitterMR Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/andreshere00/Splitter_MR" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    andreshere00/Splitter_MR
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_reference/api_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_reference/reader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Readers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_reference/splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Splitters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_reference/model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vision models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_reference/embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reading
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Reading
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pdf/pdf_without_vlm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read PDFs without VLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pdf/pdf_with_vlm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read PDFs using VLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pdf/pdf_vanilla/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read files with VanillaReader using VLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pdf/pdf_docling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read files with Docling using VLMs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pdf/pdf_markitdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read files with MarkItDown using VLMs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Text-based splitting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Text-based splitting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fixed_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split by grammatical groups
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../recursive_character_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split by characters recursively
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../token_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split by tokens
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paged_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split by pages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Split by semantic similarity
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Split by semantic similarity
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-read-the-file" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1. Read the file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-split-by-semantic-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2. Split by semantic similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How it works
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing Parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-script" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Script
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annex-semantic-splitting-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Annex: Semantic Splitting algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Annex: Semantic Splitting algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notation" class="md-nav__link">
    <span class="md-ellipsis">
      Notation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breakpoint-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Breakpoint Selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Breakpoint Selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threshold-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Threshold Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targeting-a-desired-number-of-chunks" class="md-nav__link">
    <span class="md-ellipsis">
      Targeting a Desired Number of Chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-assembly-and-chunk_size-enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      Chunk Assembly and chunk_size Enforcement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Schema-based splitting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Schema-based splitting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schema/html_tag_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split by HTML Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schema/code_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split by Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schema/json_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split JSON recursively
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schema/row_column_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split tables by rows or columns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../schema/header_splitter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split Markdown and HTML files by headers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CHANGELOG
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-read-the-file" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1. Read the file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-split-by-semantic-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2. Split by semantic similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How it works
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing Parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-script" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Script
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annex-semantic-splitting-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Annex: Semantic Splitting algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Annex: Semantic Splitting algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notation" class="md-nav__link">
    <span class="md-ellipsis">
      Notation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#breakpoint-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Breakpoint Selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Breakpoint Selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threshold-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Threshold Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#targeting-a-desired-number-of-chunks" class="md-nav__link">
    <span class="md-ellipsis">
      Targeting a Desired Number of Chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunk-assembly-and-chunk_size-enforcement" class="md-nav__link">
    <span class="md-ellipsis">
      Chunk Assembly and chunk_size Enforcement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="example-splitting-files-by-semantic-similarity-using-semanticsplitter"><strong>Example</strong>: Splitting Files by Semantic Similarity using <code>SemanticSplitter</code><a class="headerlink" href="#example-splitting-files-by-semantic-similarity-using-semanticsplitter" title="Permanent link">&para;</a></h1>
<p><img alt="Semantic splitting illustration" src="https://arxiv.org/html/2410.13070v1/extracted/5932831/images/chunkers.png" /></p>
<p>For some documents, the best splitting strategy is to break them at <strong>semantic boundaries</strong> rather than fixed lengths or pages. This is exactly what the <a href="../../../api_reference/splitter/#semanticsplitter"><strong><code>SemanticSplitter</code></strong></a> does, which uses <strong>cosine similarity</strong> to detect topic or meaning shifts between sentences. This allows to produce semantically coherent chunks.</p>
<p>In this example, we will read the famous <strong>Pinocchio</strong> tale (<a href="https://raw.githubusercontent.com/andreshere00/Splitter_MR/refs/heads/main/data/pinocchio_example.md"><code>pinocchio_example.md</code></a>) using <a href="https://andreshere00.github.io/Splitter_MR/api_reference/reader/#vanillareader"><code>VanillaReader</code></a>, and then split it into chunks using <a href="https://andreshere00.github.io/Splitter_MR/api_reference/splitter/#semanticsplitter"><strong><code>SemanticSplitter</code></strong></a>.</p>
<h2 id="step-1-read-the-file">Step 1. Read the file<a class="headerlink" href="#step-1-read-the-file" title="Permanent link">&para;</a></h2>
<p>You can read the file using <code>VanillaReader</code> or any other <a href="https://andreshere00.github.io/Splitter_MR/api_reference/reader/"><code>Reader</code></a> that outputs a <a href="../../../api_reference/reader/#output-format"><code>ReaderOutput</code> object</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">splitter_mr.reader</span><span class="w"> </span><span class="kn">import</span> <span class="n">VanillaReader</span>

<span class="n">FILE_PATH</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/andreshere00/Splitter_MR/refs/heads/main/data/pinocchio_example.md&quot;</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">VanillaReader</span><span class="p">()</span>
<span class="n">reader_output</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">FILE_PATH</span><span class="p">)</span>
</code></pre></div>
<p>The output will look like:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">reader_output</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>{
    &quot;text&quot;: &quot;# Pinocchio by Carlo Colodi (*The Tale of a Puppet*)\n\n## Chapter 1\n\n### THE PIECE OF WOOD THAT LAUGHED AND CRIED LIKE A CHILD\n\nThere was once upon a time a piece of wood in the shop of an old carpenter named Master Antonio. Everybody, however, called him Master Cherry, on account of the end of his nose, which was always as red and polished as a ripe cherry.\n\nNo sooner had Master Cherry set eyes on the piece of wood than his face beamed with delight, and, rubbing his hands 
...
 rest of their lives.\n\nGeppetto carried off his fine piece of wood and, thanking Master Antonio, returned limping to his house.&quot;,
    &quot;document_name&quot;: &quot;pinocchio_example.md&quot;,
    &quot;document_path&quot;: &quot;https://raw.githubusercontent.com/andreshere00/Splitter_MR/refs/heads/main/data/pinocchio_example.md&quot;,
    &quot;document_id&quot;: &quot;9ad18596-3dbc-49ba-b428-fbd2db3fd7f4&quot;,
    &quot;conversion_method&quot;: &quot;txt&quot;,
    &quot;reader_method&quot;: &quot;vanilla&quot;,
    &quot;ocr_method&quot;: null,
    &quot;page_placeholder&quot;: null,
    &quot;metadata&quot;: {}
}
</code></pre></div>

<p>Note that this is a Pydantic object, so you can represent it as a JSON dictionary with the <code>.model_dump_json()</code> instruction.</p>
<h2 id="step-2-split-by-semantic-similarity">Step 2. Split by semantic similarity<a class="headerlink" href="#step-2-split-by-semantic-similarity" title="Permanent link">&para;</a></h2>
<p>To split semantically, instantiate the <a href="https://andreshere00.github.io/Splitter_MR/api_reference/splitter/#semanticsplitter"><code>SemanticSplitter</code></a> object with an <a href="../../../api_reference/embedding/#embedders">embedding backend</a> and call to the <code>.split()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">splitter_mr.embedding</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AzureOpenAIEmbedding</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># can be any other Embedding model.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splitter_mr.splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">SemanticSplitter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">load_dotenv</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_EMBEDDING&quot;</span><span class="p">),</span>
    <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_API_KEY&quot;</span><span class="p">),</span>
    <span class="s2">&quot;azure_deployment&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_DEPLOYMENT_EMBEDDING&quot;</span><span class="p">),</span>
    <span class="s2">&quot;api_version&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_API_VERSION&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">embedding</span> <span class="o">=</span> <span class="n">AzureOpenAIEmbedding</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># can be any other Embedding model.</span>

<span class="n">splitter</span> <span class="o">=</span> <span class="n">SemanticSplitter</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>
<span class="n">splitter_output</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">reader_output</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">splitter_output</span><span class="o">.</span><span class="n">chunks</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">80</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Chunk </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">80</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>******************************************************************************** Chunk 0 ********************************************************************************

# Pinocchio by Carlo Colodi (*The Tale of a Puppet*)

## Chapter 1

### THE PIECE OF WOOD THAT LAUGHED AND CRIED LIKE A CHILD

There was once upon a time a piece of wood in the shop of an old carpenter named Master Antonio. Everybody, however, called him Master Cherry, on account of the end of his nose, which was always as red
...
n!&quot; &quot;Pudding!&quot; On hearing himself called Pudding for the third time Geppetto, mad with rage, fell upon the carpenter and they fought desperately. When the battle was over, Master Antonio had two more scratches on his nose, and his adversary had lost two buttons off his waistcoat. Their accounts being thus squared, they shook hands and swore to remain good friends for the rest of their lives. Geppetto carried off his fine piece of wood and, thanking Master Antonio, returned limping to his house.
</code></pre></div>

<h2 id="how-it-works">How it works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h2>
<p>The <strong>SemanticSplitter</strong> algorithm:</p>
<ol>
<li><strong>Sentence Splitting</strong> — Breaks text into individual sentences using <a href="https://andreshere00.github.io/Splitter_MR/api_reference/splitter/#sentencesplitter"><code>SentenceSplitter</code></a>.</li>
<li><strong>Sliding Window Context</strong> — Combines each sentence with <code>buffer_size</code> neighbors before and after for better semantic representation.</li>
<li><strong>Embedding Generation</strong> — Uses the provided <a href="https://andreshere00.github.io/Splitter_MR/api_reference/embedding#baseembedding"><code>BaseEmbedding</code></a> model to get vector representations of each combined sentence.</li>
<li><strong>Distance Calculation</strong> — Computes <strong>cosine distances</strong> between consecutive embeddings.</li>
<li><strong>Breakpoint Detection</strong> — Finds points where the distance exceeds a threshold (based on percentile, standard deviation, interquartile range, or gradient).</li>
<li><strong>Chunk Assembly</strong> — Merges sentences between breakpoints into chunks, ensuring each meets the minimum <code>chunk_size</code>.</li>
</ol>
<p>To consult information more-in-depth about how this algorithm works, you can check the following <a href="#annex-semantic-splitting-algorithm"><strong>section</strong></a>.</p>
<h2 id="customizing-parameters">Customizing Parameters<a class="headerlink" href="#customizing-parameters" title="Permanent link">&para;</a></h2>
<p>You can adjust how chunks are detected and their minimum length:</p>
<div class="highlight"><pre><span></span><code><span class="n">splitter</span> <span class="o">=</span> <span class="n">SemanticSplitter</span><span class="p">(</span>
    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
    <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># number of neighbor sentences to include</span>
    <span class="n">breakpoint_threshold_type</span><span class="o">=</span><span class="s2">&quot;percentile&quot;</span><span class="p">,</span>  <span class="c1"># method for determining breakpoints</span>
    <span class="n">breakpoint_threshold_amount</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span>  <span class="c1"># threshold value (percentile here)</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>  <span class="c1"># minimum characters per chunk</span>
<span class="p">)</span>
<span class="n">splitter_output</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">reader_output</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">splitter_output</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>{
    &quot;chunks&quot;: [
        &quot;# Pinocchio by Carlo Colodi (*The Tale of a Puppet*)\n\n## Chapter 1\n\n### THE PIECE OF WOOD THAT LAUGHED AND CRIED LIKE A CHILD\n\nThere was once upon a time a piece of wood in the shop of an old carpenter named Master Antonio. Everybody, however, called him Master Cherry, on account of the end of his nose, which was always as red and polished as a ripe cherry. No sooner had Master Cherry set eyes on the piece of wood than his face beamed with delight, and, rubbing h
...
  &quot;document_id&quot;: &quot;9ad18596-3dbc-49ba-b428-fbd2db3fd7f4&quot;,
    &quot;conversion_method&quot;: &quot;txt&quot;,
    &quot;reader_method&quot;: &quot;vanilla&quot;,
    &quot;ocr_method&quot;: null,
    &quot;split_method&quot;: &quot;semantic_splitter&quot;,
    &quot;split_params&quot;: {
        &quot;buffer_size&quot;: 1,
        &quot;breakpoint_threshold_type&quot;: &quot;percentile&quot;,
        &quot;breakpoint_threshold_amount&quot;: 80.0,
        &quot;number_of_chunks&quot;: null,
        &quot;chunk_size&quot;: 1000,
        &quot;model_name&quot;: &quot;es-BPE_GENAI_CLASSIFIER_AGENT-llm-lab-embedding-3-large&quot;
    },
    &quot;metadata&quot;: {}
}
</code></pre></div>

<p>In this case, more chunks are extracted since the splitter becomes more sensitive to smaller semantic changes.</p>
<p>Other available <a href="https://andreshere00.github.io/Splitter_MR/api_reference/splitter/#splitter_mr.splitter.splitters.semantic_splitter.SemanticSplitter"><code>breakpoint_threshold_type</code></a> values are:</p>
<ul>
<li><code>"percentile"</code> — Split at distances above a given percentile.</li>
<li><code>"standard_deviation"</code> — Split at mean + (amount × std deviation).</li>
<li><code>"interquartile"</code> — Split at mean + (amount × IQR).</li>
<li><code>"gradient"</code> — Split at steep changes in distance.</li>
</ul>
<p>Alternatively, you can also directly control the <strong>number of chunks</strong> by setting <code>number_of_chunks</code>.</p>
<hr />
<h2 id="complete-script">Complete Script<a class="headerlink" href="#complete-script" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">splitter_mr.embedding</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureOpenAIEmbedding</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splitter_mr.reader</span><span class="w"> </span><span class="kn">import</span> <span class="n">VanillaReader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splitter_mr.splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">SemanticSplitter</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="n">load_dotenv</span><span class="p">()</span>

<span class="n">FILE_PATH</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/andreshere00/Splitter_MR/refs/heads/main/data/pinocchio_example.md&quot;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_EMBEDDING&quot;</span><span class="p">),</span>
    <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_API_KEY&quot;</span><span class="p">),</span>
    <span class="s2">&quot;azure_deployment&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_DEPLOYMENT_EMBEDDING&quot;</span><span class="p">),</span>
    <span class="s2">&quot;api_version&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;AZURE_OPENAI_API_VERSION&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">embedding</span> <span class="o">=</span> <span class="n">AzureOpenAIEmbedding</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># can be any other Embedding model.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">VanillaReader</span><span class="p">()</span>
<span class="n">reader_output</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">FILE_PATH</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Output from Reader: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reader_output</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="n">splitter</span> <span class="o">=</span> <span class="n">SemanticSplitter</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>
<span class="n">splitter_output</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">reader_output</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Output from Splitter: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">splitter_output</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">splitter_output</span><span class="o">.</span><span class="n">chunks</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Chunk </span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>****************************************
 Output from Reader: 
****************************************
{
    &quot;text&quot;: &quot;# Pinocchio by Carlo Colodi (*The Tale of a Puppet*)\n\n## Chapter 1\n\n### THE PIECE OF WOOD THAT LAUGHED AND CRIED LIKE A CHILD\n\nThere was once upon a time a piece of wood in the shop of an old carpenter named Master Antonio. Everybody, however, called him Master Cherry, on account of the end of his nose, which was always as red and polished as a ripe cherry.\n\nNo sooner ha
...
n!&quot; &quot;Pudding!&quot; On hearing himself called Pudding for the third time Geppetto, mad with rage, fell upon the carpenter and they fought desperately. When the battle was over, Master Antonio had two more scratches on his nose, and his adversary had lost two buttons off his waistcoat. Their accounts being thus squared, they shook hands and swore to remain good friends for the rest of their lives. Geppetto carried off his fine piece of wood and, thanking Master Antonio, returned limping to his house.
</code></pre></div>

<hr />
<h2 id="annex-semantic-splitting-algorithm">Annex: Semantic Splitting algorithm<a class="headerlink" href="#annex-semantic-splitting-algorithm" title="Permanent link">&para;</a></h2>
<p>The Semantic Splitter detects <strong>semantic shift points</strong> between adjacent sentence windows by:</p>
<ol>
<li>Splitting the text into sentences.</li>
<li>Creating a <strong>sliding window</strong> around each sentence (<code>buffer_size</code> neighbors on both sides).</li>
<li>Embedding each window with the configured <code>BaseEmbedding</code>.</li>
<li>Computing <strong>cosine distances</strong> between consecutive windows.</li>
<li>Selecting <strong>breakpoints</strong> where the signal exceeds a threshold (or meets a desired number of chunks).</li>
<li>Emitting chunks between breakpoints, honoring a <strong>minimum</strong> <code>chunk_size</code> (in characters).</li>
</ol>
<p>Below, the full process will be detailed.</p>
<h3 id="notation">Notation<a class="headerlink" href="#notation" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Let the document be split into sentences <span class="arithmatex">\( S = [s_0, s_1, \ldots, s_{n-1}] \)</span>.</p>
</li>
<li>
<p>For each index <span class="arithmatex">\( i \)</span>, define a <strong>window</strong> <span class="arithmatex">\( w_i \)</span> as the concatenation of sentences</p>
</li>
</ul>
<p>$$
  w_i = \text{concat}\big(s_{\max(0,\, i-b)}, \ldots, s_i, \ldots, s_{\min(n-1,\, i+b)}\big),
  $$
  where <span class="arithmatex">\( b = \texttt{buffer\_size} \)</span>.</p>
<ul>
<li>
<p>Let <span class="arithmatex">\( \mathbf{e}_i = \text{embed}(w_i) \in \mathbb{R}^d \)</span> be the embedding vector.</p>
</li>
<li>
<p>Define <strong>cosine similarity</strong> and <strong>distance</strong>:</p>
</li>
</ul>
<div class="arithmatex">\[\text{cos\_sim}(\mathbf{e}_i, \mathbf{e}_{i+1})= \frac{\mathbf{e}_i \cdot \mathbf{e}_{i+1}}{\lVert \mathbf{e}_i \rVert \, \lVert \mathbf{e}_{i+1} \rVert + \varepsilon}, \qquad d_i = 1 - \operatorname{cos\_sim}(\mathbf{e}_i, \mathbf{e}_{i+1}),\]</div>
<p>with a small <span class="arithmatex">\( \varepsilon \)</span> for numerical stability.</p>
<p>We obtain a distance vector <span class="arithmatex">\( D = [d_0, d_1, \ldots, d_{n-2}] \)</span> (length <span class="arithmatex">\( n-1 \)</span>).</p>
<h3 id="breakpoint-selection">Breakpoint Selection<a class="headerlink" href="#breakpoint-selection" title="Permanent link">&para;</a></h3>
<p>Let $ R $ be the <strong>reference array</strong> used to select cut indices:
- For most strategies, $ R = D $.
- For <code>"gradient"</code>, compute $ G = \nabla D $ and set $ R = G $.</p>
<p>We then choose a <strong>threshold</strong> $ T $ and mark <strong>breakpoints</strong> at all indices $ i $ where $ R[i] &gt; T $.</p>
<h4 id="threshold-strategies">Threshold Strategies<a class="headerlink" href="#threshold-strategies" title="Permanent link">&para;</a></h4>
<p><strong>Percentile</strong> (default):</p>
<ul>
<li>$ T = \text{percentile}(D, p) $, where $ p \in [0, 100] $.</li>
<li>Intuition: cut at the largest $ (100 - p)\% $ jumps.</li>
</ul>
<p><strong>Standard Deviation</strong>:</p>
<ul>
<li>$ \mu = \text{mean}(D),\ \sigma = \text{std}(D) $</li>
<li>$ T = \mu + \alpha \sigma $ (e.g., $ \alpha=3 $).</li>
<li>Intuition: cut on statistical outliers.</li>
</ul>
<p><strong>Interquartile (IQR)</strong>:</p>
<ul>
<li>$ Q_1, Q_3 = \text{percentile}(D, 25), \text{percentile}(D, 75) $</li>
<li>$ \text{IQR} = Q_3 - Q_1,\ \mu = \text{mean}(D) $</li>
<li>$ T = \mu + \beta \cdot \text{IQR} $ (e.g., $ \beta=1.5 $).</li>
<li>Intuition: robust outlier detection vs. heavy tails.</li>
</ul>
<p><strong>Gradient</strong>:</p>
<ul>
<li>Compute $ G = \nabla D $ and threshold by percentile on $ G $:
     $ T = \text{percentile}(G, p) $.</li>
<li><strong>Intuition</strong>: cut at steep <strong>changes</strong> in the distance signal (useful when distances drift).</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code>"percentile"</code> and <code>"gradient"</code>, the class accepts <code>breakpoint_threshold_amount</code> in either <span class="arithmatex">\([0, 1]\)</span> (interpreted as a fraction, converted internally to <span class="arithmatex">\([0,100]\)</span>) or <span class="arithmatex">\([0,100]\)</span> (as a percentile). For <code>"standard_deviation"</code> and <code>"interquartile"</code>, the amount is a <strong>multiplier</strong> (<span class="arithmatex">\(\alpha\)</span> or <span class="arithmatex">\(\beta\)</span>).</p>
</div>
<h3 id="targeting-a-desired-number-of-chunks">Targeting a Desired Number of Chunks<a class="headerlink" href="#targeting-a-desired-number-of-chunks" title="Permanent link">&para;</a></h3>
<p>If <code>number_of_chunks</code> is set, the splitter <strong>maps</strong> the requested count to an <strong>inverse percentile</strong> over $ D $:</p>
<ul>
<li>
<p>Let $ m = |D| $. Requested chunks $ k $ are mapped to a percentile $ y \in [0,100] $ such that:</p>
</li>
<li>
<p>$ k=1 \Rightarrow y \approx 100 $ (almost no cuts),</p>
</li>
<li>
<p>$ k=m \Rightarrow y \approx 0 $ (many cuts).</p>
</li>
<li>
<p>The threshold is then $ T = \text{percentile}(D, y) $.</p>
</li>
</ul>
<p>This provides an approximate, monotonic control over chunk count without explicit clustering.</p>
<h3 id="chunk-assembly-and-chunk_size-enforcement">Chunk Assembly and <code>chunk_size</code> Enforcement<a class="headerlink" href="#chunk-assembly-and-chunk_size-enforcement" title="Permanent link">&para;</a></h3>
<p>After computing indices $ \mathcal{B} = {i \mid R[i] &gt; T} $, we sweep left-to-right:</p>
<ol>
<li>Maintain a <code>start_idx</code> (initially 0).</li>
<li>For each $ i \in \mathcal{B} $ in ascending order, propose a cut <strong>after</strong> sentence $ i $ (i.e., up to index $ i $ inclusive).</li>
<li>Build the candidate chunk $ C = \text{concat}(s_{\text{start}}, \ldots, s_{i}) $.</li>
<li>If <code>len(C) &gt;= chunk_size</code>, <strong>emit</strong> the chunk and set <code>start_idx = i + 1</code>.</li>
<li>After the sweep, <strong>emit the tail</strong> (if non-empty).</li>
</ol>
<p>If no candidate passes <code>chunk_size</code>, the splitter <strong>falls back</strong> to a single chunk (all sentences concatenated).</p>
<blockquote>
<p><code>chunk_size</code> is a <strong>minimum</strong> only. Chunks can be <strong>larger</strong> depending on where valid cut points occur.</p>
</blockquote>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>